---
title: "Prac2"
author: "Xuan Zheng & Albert Casanova González"
date: "5/27/2022"
output: html_document
---
Instalamos y cargamos las librerías ggplot2 y dplry.
```{r message= FALSE, warning=FALSE}
# https://cran.r-project.org/web/packages/ggplot2/index.html
if (!require('ggplot2')) install.packages('ggplot2'); library('ggplot2')
# https://cran.r-project.org/web/packages/dplyr/index.html
if (!require('dplyr')) install.packages('dplyr'); library('dplyr')
```

******
# Lectura del dataset
******
Cargamos el fichero de datos.
```{r message= FALSE, warning=FALSE}
titanic <- read.csv('train.csv')
```

Verificamos la estructura del juego de datos.
```{r message= FALSE, warning=FALSE}
str(titanic)
```

## Detección de valores ceros y valores perdidos
1. valores ceros
Con la función *summary*, podemos ver las columnas que contienen valores 0, por ejemplo *SibSp*, *Parch*, *Fare*, etc. Pero consideramos que estos valores 0 tiene un significado real. Por lo tanto, no debemos mofidicarlo. 
```{r message= FALSE, warning=FALSE}
summary(titanic)
```

2. valores perdidos
Primero, buscamos los valores NAs que existen en el dataset y imputarlos con la mediana de edad de todos los registros.
```{r message= FALSE, warning=FALSE}
colSums(is.na(titanic)) # hay valores perdidos en Age
titanic$Age[is.na(titanic$Age)] <- median(titanic$Age,na.rm=T)
```

Segundo, buscado los strings vacíos que existen en el dataset y sustituirlos con 'Desconocido' para que queden más claro.
```{r message= FALSE, warning=FALSE}
colSums(titanic=="") # hay strings vacíos en Embarked y Cabin
titanic$Embarked[titanic$Embarked==""] <- "Desconocido"
titanic$Cabin[titanic$Cabin==""] <- "Desconocido"
```

## Detección de valores extremos 
Aplicamos el diagrama de caja en las columnas numéricas para encontrar los valores extremos.
```{r message= FALSE, warning=FALSE}
boxplot(titanic$Age)
boxplot(titanic$SibSp)
boxplot(titanic$Fare)
```
Podemos ver que existen valores extremos en las columnas *Age*, *SibSp* y *Fare*. 

Aplicamos el histograma para verificar la distribución de dichas columnas.
```{r message= FALSE, warning=FALSE}
hist(titanic$Age)
hist(titanic$SibSp)
hist(titanic$Fare)
```

Como los registros de valores extremos de *SibSp* y *Fare* son muy pocos, los eliminamos. Vemos que la distribución de *Age* más o menos sigue la normalidad, entonces dejamos los datos así.
```{r message= FALSE, warning=FALSE}
titanic <- titanic[titanic$SibSp!=8, ]
titanic <- titanic[titanic$Fare<500, ]
```

## 4. Análisis de los datos.

Vamos a eliminar variables que no aportan demasiado al estudio que estamos realizando, Estas son PassengerId, Name, Ticket y Cabin

```{r message= FALSE, warning=FALSE}
titanic <- titanic %>% select(-c(PassengerId, Name, Ticket, Cabin))
```

Transformamos las variables Survived, Pclass, Sex y Embarked a factor. La variable Age a int

```{r message= FALSE, warning=FALSE}
titanic$Survived<-as.factor(titanic$Survived)
titanic$Pclass<-as.factor(titanic$Pclass)
titanic$Sex<-as.factor(titanic$Sex)
titanic$Embarked<-as.factor(titanic$Embarked)
titanic$Age<-as.integer(titanic$Age)
```



## Normalidad
```{r message= FALSE, warning=FALSE}
# Instalamos las librerias necesarias
if(!require(nortest)){
    install.packages('nortest', repos='http://cran.us.r-project.org')
    library(nortest)
}
```


```{r message= FALSE, warning=FALSE}
qqnorm(titanic$Age)
qqline(titanic$Age)
```

Como podemos observar los puntos no están sobre la línea diagonal, por lo que podemos descartar normalidad en los datos.

```{r message= FALSE, warning=FALSE}
lillie.test(titanic$Age)
```
Con el valor del p-value, que es menor que el nivel de significancia (por ejemplo 0.05), podemos rechazar la hipótesis nula de normalidad de los datos.

```{r message= FALSE, warning=FALSE}
qqnorm(titanic$Fare)
qqline(titanic$Fare)
```
Como podemos observar los puntos no están sobre la línea diagonal, por lo que podemos descartar normalidad en los datos.

```{r message= FALSE, warning=FALSE}
lillie.test(titanic$Fare)
```
Con el valor del p-value, que es menor que el nivel de significancia (por ejemplo 0.05), podemos rechazar la hipótesis nula de normalidad de los datos.


## 4.3. Aplicación de pruebas estadísticas para comparar los grupos de datos

### Predicción
```{r message= FALSE, warning=FALSE}
# Separamos en dataset de train y de test
split = sort(sample(nrow(titanic), nrow(titanic)*0.8))

train <- titanic[split,]
test <- titanic[-split,]
```

```{r message= FALSE, warning=FALSE}
# Creamos el modelo de regresión logística
model_logist <- glm(Survived ~ . , data = train, family ="binomial")
```

```{r message= FALSE, warning=FALSE}
summary(model_logist)
```

```{r message= FALSE, warning=FALSE}
# Instalamos los paquetes requeridos
if(!require(caret)){
    install.packages('caret', repos='http://cran.us.r-project.org')
    library(caret)
}
```

```{r message= FALSE, warning=FALSE}
# Realizamos predicción sobre el test
pred_test = predict(model_logist, test, type = "response")
```

```{r message= FALSE, warning=FALSE}
# Definimos a partir de qué probabilidad queremos que asigne a 1 o a 0 y mostramos la matriz de confusión
pred_test = as.factor(ifelse(pred_test >= 0.5, yes = 1, no = 0))
confusionMatrix(test$Survived, pred_test)
```

```{r message= FALSE, warning=FALSE}

```

```{r message= FALSE, warning=FALSE}

```

```{r message= FALSE, warning=FALSE}

```

```{r message= FALSE, warning=FALSE}

```

```{r message= FALSE, warning=FALSE}

```

```{r message= FALSE, warning=FALSE}

```

```{r message= FALSE, warning=FALSE}

```